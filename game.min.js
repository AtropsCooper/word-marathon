const canvasWidth=430,canvasHeight=466;var stage,loader,inputbox,loadText,car,meterPointer,meterText,travelMapCar,currentWordText,currentWordWrapper,acceleratingText,canvasScale=1;const bgWidth=1398,bgHeight=466;var bgScale=.7;const wordBgColor=["#5bb2d0","#e4c36a","#f2741f"];var words=[];const totalDistance=2e3;var currPosition=0,drivingSpeed=0,targetDrivingSpeed=0,intervalLastMove=0,bonus=0;const bgSequence=["city1.back","city2.back","rural1.back","rural2.back","seaside1.back","seaside2.back"],fgSequence=["city1.front","city2.front","rural1.front","rural2.front","seaside.front","seaside.front"];var bgContainer=new createjs.Container,fgContainer=new createjs.Container,sequenceCounter=0;function init(){(stage=new createjs.StageGL("gameCanvas",{antialias:!0})).setClearColor("#000000"),createjs.Ticker.timingMode=createjs.Ticker.RAF_SYNCHED,createjs.Ticker.framerate=60,createjs.Ticker.addEventListener("tick",stage),window.addEventListener("resize",handleResize),handleResize(),phase="city",(loader=new createjs.LoadQueue(!0)).setMaxConnections(8),loader.addEventListener("progress",handleProgress),loader.addEventListener("complete",handleComplete),(loadText=new createjs.Text("Loading...","26px sans-serif","#ffffff")).textAlign="center",loadText.x=215,loadText.y=233;var e=loadText.getBounds();loadText.cache(e.x-e.width,e.y,3*e.width,e.height),stage.addChild(loadText),loader.loadManifest([{src:"./src/car.png",id:"car"},{src:"./src/city1-back.png",id:"city1.back"},{src:"./src/city1-front.png",id:"city1.front"},{src:"./src/city2-back.png",id:"city2.back"},{src:"./src/city2-front.png",id:"city2.front"},{src:"./src/rural1-back.jpg",id:"rural1.back"},{src:"./src/rural1-front.png",id:"rural1.front"},{src:"./src/rural2-back.jpg",id:"rural2.back"},{src:"./src/rural2-front.png",id:"rural2.front"},{src:"./src/seaside1-back.png",id:"seaside1.back"},{src:"./src/seaside2-back.png",id:"seaside2.back"},{src:"./src/seaside-front.png",id:"seaside.front"},{src:"./src/pointer.png",id:"pointer"},{src:"./src/clock.png",id:"clock"},{src:"./src/travelmap.png",id:"travelmap"},{src:"./src/travelmapcar.png",id:"travelmapcar"},],!0,"./"),loadWords(),stage.update()}function loadWords(){fetch("./src/words.json").then(e=>{if(!e.ok)throw Error(`HTTP error! Status: ${e.status}`);return e.json()}).then(e=>{if(!Array.isArray(e))throw Error("JSON data is not an array");words=e}).catch(e=>{console.error("Fetch error:",e)})}function generateRandomWord(){let e=Math.floor(Math.random()*words.length),t=words[e].meaning,a=wordBgColor[words[e].attr-1];currentWordText=words[e].word;var r=new createjs.Text(t,"22px sans-serif","#000000");r.x=10,r.y=7;var n=r.getBounds();r.cache(n.x,n.y,n.width,n.height),null!=currentWordWrapper&&stage.removeChild(currentWordWrapper),currentWordWrapper=new createjs.Container,(wordBg=new createjs.Shape).graphics.beginFill(a).drawRoundRect(0,0,r.getMeasuredWidth()+10,34,10),wordBg.cache(0,0,r.getMeasuredWidth()+20,34),currentWordWrapper.addChild(wordBg),currentWordWrapper.addChild(r),currentWordWrapper.x=10*canvasScale,currentWordWrapper.y=472*bgScale,stage.addChild(currentWordWrapper)}function handleProgress(e){var t=e.progress;loadText.text="Loading: "+Math.round(100*t)+"%",loadText.updateCache()}function handleComplete(){stage.removeChild(loadText),createInput(),createBg(),createCar(),createFg(),createMeter(),createTravelMap(),generateRandomWord(),createjs.Ticker.addEventListener("tick",handleTick)}function createInput(){var e=new createjs.Shape;e.graphics.beginFill("#EEEEEE").drawRect(0,0,430,80),e.x=0,e.y=466*bgScale,e.cache(0,0,430,80),stage.addChild(e),(inputbox=document.createElement("input")).type="text",inputbox.style.margin="0px",inputbox.style.position="fixed",inputbox.style.left="6px",resizeInputBox(),inputbox.onkeydown=handleEnter,document.body.appendChild(inputbox),inputbox.focus()}function resizeInputBox(){inputbox.style.top=522*canvasScale*bgScale+"px",inputbox.style.width=430*canvasScale-12+"px",inputbox.style.fontSize=Math.round(20*canvasScale)+"px"}function createBg(){bgSequence.map((e,t)=>{(obj=new createjs.Bitmap(loader.getResult(e))).x=1398*t*bgScale,obj.y=0,obj.scale=bgScale,bgContainer.addChild(obj)}),bgContainer.x=0,bgContainer.y=0,stage.addChild(bgContainer)}function createFg(){fgSequence.map((e,t)=>{obj1=new createjs.Bitmap(loader.getResult(e)),obj2=new createjs.Bitmap(loader.getResult(e)),obj1.x=2*t*1398*bgScale,obj2.x=(2*t+1)*1398*bgScale,obj1.y=0,obj2.y=0,obj1.scale=bgScale,obj2.scale=bgScale,fgContainer.addChild(obj1,obj2)}),fgContainer.x=0,fgContainer.y=0,stage.addChild(fgContainer)}function createCar(){(car=new createjs.Bitmap(loader.getResult("car"))).x=85,car.y=180*bgScale,car.scale=.4,stage.addChild(car)}function createMeter(){var e=new createjs.Container,t=new createjs.Shape;t.alpha=.25,t.graphics.beginFill("#399205").drawRoundRect(0,0,100,123,15),t.cache(0,0,100,123);var a=new createjs.Bitmap(loader.getResult("clock")),r=new createjs.Bitmap(loader.getResult("pointer"));r.scale=110/300,r.x=-55,r.y=-55,(meterPointer=new createjs.Container).addChild(r),meterPointer.x=53,meterPointer.y=55.5,a.x=-4,a.y=0;var n=new createjs.Text("KM/H","16px sans-serif","#FFFFFF");n.textAlign="center",n.shadow=new createjs.Shadow("#000000",1,1,2);var i=n.getBounds();n.cache(i.x,i.y,i.width,i.height),n.x=51,n.y=107,(meterText=new createjs.Text(Math.round(drivingSpeed).toString(),"32px sans-serif","#FFFFFF")).textAlign="center",i=meterText.getBounds(),meterText.cache(i.x-i.width,i.y,3*i.width,i.height),meterText.x=51,meterText.y=76,(acceleratingText=new createjs.Text("加速中","24px sans-serif","#FFFFFF")).textAlign="center",i=acceleratingText.getBounds(),acceleratingText.cache(i.x,i.y,i.width,i.height),acceleratingText.x=51,acceleratingText.y=-24,e.addChild(t,n,meterText,acceleratingText,a,meterPointer),e.scale=.75,e.x=347.5,e.y=466*bgScale-99.75,stage.addChild(e)}function updateMeter(){meterPointer.rotation=drivingSpeed/80*190-6,meterText.text=Math.round(drivingSpeed).toString(),meterText.updateCache(),bonus>0?acceleratingText.visible=!0:acceleratingText.visible=!1}function createTravelMap(){var e=new createjs.Container,t=new createjs.Bitmap(loader.getResult("travelmap"));(travelMapCar=new createjs.Bitmap(loader.getResult("travelmapcar"))).x=0,travelMapCar.y=6,e.addChild(t,travelMapCar),e.scale=.75,e.x=141.25,e.y=10,stage.addChild(e)}function updateTravelMap(){travelMapCar.x=currPosition/2e3*340}function handleTick(e){currPosition+=e.delta/1e3*drivingSpeed,drivingSpeed+=(targetDrivingSpeed-drivingSpeed)*.1,currPosition<2e3?(bgContainer.x=-(1398*bgSequence.length*bgScale-430*canvasScale)*(currPosition/2e3),fgContainer.x=-(2*bgSequence.length*1398*bgScale-430*canvasScale)*(currPosition/2e3)):currPosition=0,intervalLastMove<=0?(bonus=0,targetDrivingSpeed=Math.max(0,targetDrivingSpeed-.01*e.delta)):intervalLastMove-=e.delta,updateMeter(),updateTravelMap()}function handleEnter(e){13==e.keyCode&&(currentWordText==inputbox.value&&(targetDrivingSpeed=Math.min(80,targetDrivingSpeed+5+bonus),bonus=Math.min(35,bonus+5),intervalLastMove=4e3,generateRandomWord()),inputbox.value="")}function handleResize(e){w=window.innerWidth,h=window.innerHeight,canvasScale=Math.min(1,w/430),stage.scale=canvasScale,inputbox&&resizeInputBox(),stage.canvas.width=Math.min(430,w),stage.updateViewport(Math.min(430,w),466),stage.update()}document.addEventListener("scroll",e=>{scrollLock&&document.documentElement.scrollTop>100&&(document.documentElement.scrollTop=100)});