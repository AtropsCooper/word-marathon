const canvasWidth=430,canvasHeight=932,bgWidth=1398,bgHeight=466,bgScale=1,wordBgColor=["#5bb2d0","#e4c36a","#f2741f"],words=[{word:"eat",attr:1,meaning:"吃"},{word:"apple",attr:2,meaning:"苹果"},{word:"red",attr:3,meaning:"红色"},],totalDistance=2e3;var stage,loader,inputbox,wordText,phase,car,meterPointer,meterText,travelMapCar,currentWordText,currentWordWrapper,acceleratingText,currPosition=0,drivingSpeed=0,drivingSpeedGoal=0,intervalLastMove=0,bonus=0;const bgSequence=["city1.back","city2.back","rural1.back","rural2.back","seaside1.back","seaside2.back"],fgSequence=["city1.front","city2.front","rural1.front","rural2.front","seaside.front","seaside.front"];var bgContainer=new createjs.Container,fgContainer=new createjs.Container,sequenceCounter=0;function init(){stage=new createjs.StageGL("gameCanvas"),createjs.Ticker.timingMode=createjs.Ticker.RAF_SYNCHED,createjs.Ticker.framerate=60,createjs.Ticker.addEventListener("tick",stage);var e=new createjs.Shape;e.graphics.beginLinearGradientFill(["#2573BB","#6CB8DA","#567A32"],[0,.85,1],0,0,0,932).drawRect(0,0,430,932),e.x=0,e.y=0,e.name="background",e.cache(0,0,430,932),stage.addChild(e),phase="city",(loader=new createjs.LoadQueue(!0)).addEventListener("complete",handleComplete),loader.loadManifest([{src:"src/car.png",id:"car"},{src:"src/city1-back.png",id:"city1.back"},{src:"src/city1-front.png",id:"city1.front"},{src:"src/city2-back.png",id:"city2.back"},{src:"src/city2-front.png",id:"city2.front"},{src:"src/rural1-back.jpg",id:"rural1.back"},{src:"src/rural1-front.png",id:"rural1.front"},{src:"src/rural2-back.jpg",id:"rural2.back"},{src:"src/rural2-front.png",id:"rural2.front"},{src:"src/seaside1-back.jpg",id:"seaside1.back"},{src:"src/seaside2-back.jpg",id:"seaside2.back"},{src:"src/seaside-front.png",id:"seaside.front"},{src:"src/pointer.png",id:"pointer"},{src:"src/clock.png",id:"clock"},{src:"src/travelmap.png",id:"travelmap"},{src:"src/travelmapcar.png",id:"travelmapcar"},],!0,"./"),stage.update()}function loadWords(){}function generateRandomWord(){let e=Math.floor(Math.random()*words.length),r=words[e].word,t=wordBgColor[words[e].attr-1];var a=new createjs.Text(r,"22px sans-serif","#000000");a.x=10,a.y=7;var n=a.getBounds();a.cache(n.x,n.y,n.width,n.height),null!=currentWordWrapper&&stage.removeChild(currentWordWrapper),currentWordWrapper=new createjs.Container,(wordBg=new createjs.Shape).graphics.beginFill(t).drawRoundRect(0,0,a.getMeasuredWidth()+20,34,10),wordBg.cache(0,0,a.getMeasuredWidth()+20,34),currentWordWrapper.addChild(wordBg),currentWordWrapper.addChild(a),currentWordWrapper.x=10,currentWordWrapper.y=470,stage.addChild(currentWordWrapper)}function handleComplete(){createInput(),createBg(),createCar(),createFg(),createMeter(),createTravelMap(),generateRandomWord(),createjs.Ticker.addEventListener("tick",handleTick)}function createInput(){var e=new createjs.Shape;e.graphics.beginFill("#EEEEEE").drawRect(0,0,430,80),e.x=0,e.y=466,e.cache(0,0,430,80),stage.addChild(e),(inputbox=document.createElement("input")).type="text",inputbox.style.position="fixed",inputbox.style.left="14px",inputbox.style.top="518px",inputbox.style.width="416px",inputbox.style.fontSize="20",inputbox.onkeydown=handleEnter,document.body.appendChild(inputbox),inputbox.focus()}function createBg(){bgSequence.map((e,r)=>{(obj=new createjs.Bitmap(loader.getResult(e))).x=1398*r,obj.y=0,obj.scale=1,bgContainer.addChild(obj)}),bgContainer.x=0,bgContainer.y=0,stage.addChild(bgContainer)}function createFg(){fgSequence.map((e,r)=>{obj1=new createjs.Bitmap(loader.getResult(e)),obj2=new createjs.Bitmap(loader.getResult(e)),obj1.x=2*r*1398,obj2.x=(2*r+1)*1398,obj1.y=0,obj2.y=0,obj1.scale=1,obj2.scale=1,fgContainer.addChild(obj1,obj2)}),fgContainer.x=0,fgContainer.y=0,stage.addChild(fgContainer)}function createCar(){(car=new createjs.Bitmap(loader.getResult("car"))).x=85,car.y=190,car.scale=.4,stage.addChild(car)}function createMeter(){var e=new createjs.Container,r=new createjs.Shape;r.alpha=.25,r.graphics.beginFill("#399205").drawRoundRect(0,0,100,123,15),r.cache(0,0,100,123);var t=new createjs.Bitmap(loader.getResult("clock")),a=new createjs.Bitmap(loader.getResult("pointer"));a.scale=110/300,a.x=-55,a.y=-55,(meterPointer=new createjs.Container).addChild(a),meterPointer.x=53,meterPointer.y=55.5,t.x=-4,t.y=0;var n=new createjs.Text("KM/H","12px sans-serif","#FFFFFF");n.textAlign="center",n.shadow=new createjs.Shadow("#000000",1,1,2);var i=n.getBounds();n.cache(i.x,i.y,i.width,i.height),n.x=51,n.y=111,(meterText=new createjs.Text(Math.round(drivingSpeed).toString(),"26px sans-serif","#FFFFFF")).textAlign="center",i=meterText.getBounds(),meterText.cache(i.x-i.width,i.y,3*i.width,i.height),meterText.x=51,meterText.y=80,(acceleratingText=new createjs.Text("加速中","22px sans-serif","#FFFFFF")).textAlign="center",i=acceleratingText.getBounds(),acceleratingText.cache(i.x,i.y,i.width,i.height),acceleratingText.x=51,acceleratingText.y=-24,e.addChild(r,n,meterText,acceleratingText,t,meterPointer),e.x=320,e.y=330,stage.addChild(e)}function updateMeter(){meterPointer.rotation=drivingSpeed/80*190-6,meterText.text=Math.round(drivingSpeed).toString(),meterText.updateCache(),bonus>0?acceleratingText.visible=!0:acceleratingText.visible=!1}function createTravelMap(){var e=new createjs.Container;e.x=45,e.y=50;var r=new createjs.Bitmap(loader.getResult("travelmap"));(travelMapCar=new createjs.Bitmap(loader.getResult("travelmapcar"))).x=0,travelMapCar.y=6,e.addChild(r,travelMapCar),stage.addChild(e)}function updateTravelMap(){travelMapCar.x=currPosition/2e3*340}function handleTick(e){currPosition+=e.delta/1e3*drivingSpeed,drivingSpeed+=(drivingSpeedGoal-drivingSpeed)*.1,currPosition<2e3?(bgContainer.x=-(1398*bgSequence.length-430)*(currPosition/2e3),fgContainer.x=-(2*bgSequence.length*1398-430)*(currPosition/2e3)):currPosition=0,intervalLastMove<=0?(bonus=0,drivingSpeedGoal=Math.max(0,drivingSpeedGoal-.01*e.delta)):intervalLastMove-=e.delta,updateMeter(),updateTravelMap()}function handleEnter(e){13==e.keyCode&&(inputbox.value="",drivingSpeedGoal=Math.min(80,drivingSpeedGoal+5+bonus),bonus=Math.min(35,bonus+5),intervalLastMove=4e3,generateRandomWord())}